@using Shared.DTO.POModule
<MudTable T="InvoiceDto"
          ServerData="GetServerData"
          Hover="true"
          Breakpoint="Breakpoint.Sm"
          Dense="true"
          @ref="_table"
          RowsPerPage="10"
          Virtualize="true"
          Class="invoice-table mt-0">
    <HeaderContent>
        <MudTh>Inv Nr</MudTh>
        <MudTh>Date</MudTh>
        <MudTh>Amount</MudTh>
        <MudTh>Status</MudTh>
        <MudTh>SLA</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Invoice Number">
            <div class="hover-wrapper">
                <MudLink Typo="Typo.caption" Href="@($"{invoiceViewPage}/{context.Id}")">
                    @context.InvoiceRefNo
                </MudLink>

                <div class="hover-info" role="tooltip" aria-hidden="true">
                    <div class="hover-row"><strong>Vendor:</strong> @context.VendorName</div>
                    <div class="hover-row"><strong>PO No:</strong> @context.SAPPONumber</div>
                    <div class="hover-row"><strong>PO Date:</strong> @FormatDate(context.SAPPODate)</div>
                </div>
            </div>
        </MudTd>
        <MudTd DataLabel="Date" Style="text-wrap:nowrap">@FormatDate(@context.InvoiceDate)</MudTd>
        @* <MudTd DataLabel="PO No">
            <MudLink Typo="Typo.caption" Href="@($"ViewPurchaseOrder/{context.PurchaseOrderId}")" Color="Color.Primary" Underline="Underline.Hover">
                @context.SAPPONumber
            </MudLink>
        </MudTd>
        <MudTd DataLabel="Po Date">@FormatDate(@context.SAPPODate)</MudTd> *@
        <MudTd DataLabel="Total Amount"><CurrencyText Amount="@context.InvoiceTotalValue" /></MudTd>
        <MudTd DataLabel="Current Status">@TrimInvoiceStatus(context.InvoiceStatus)</MudTd>
        @switch (@context.NextActionBy)
        {
            case "Initiator":
                <MudTd DataLabel="SLA Status">
                    <MudChip T="string"
                             Size="Size.Small"
                             Variant="Variant.Filled"
                             Color="@GetSLAChipColor(context.InitiatorReviewSLAStatus ?? "NA")">
                        @context.InitiatorReviewSLAStatus
                    </MudChip>
                </MudTd>
                break;
            case "Checker":
                <MudTd DataLabel="SLA Status">
                    <MudChip T="string"
                             Size="Size.Small"
                             Variant="Variant.Filled"
                             Color="@GetSLAChipColor(context.CheckerReviewSLAStatus ?? "NA")">
                        @context.CheckerReviewSLAStatus
                    </MudChip>
                </MudTd>
                break;
            case "Approver":
                <MudTd DataLabel="SLA Status">
                    <MudChip T="string"
                             Size="Size.Small"
                             Variant="Variant.Filled"
                             Color="@GetSLAChipColor(context.ApproverReviewSLAStatus ?? "NA")">
                        @context.ApproverReviewSLAStatus
                    </MudChip>
                </MudTd>
                break;
            case "Validator":
                <MudTd DataLabel="SLA Status">
                    <MudChip T="string"
                             Size="Size.Small"
                             Variant="Variant.Filled"
                             Color="@GetSLAChipColor(context.ValidatorReviewSLAStatus ?? "NA")">
                        @context.ValidatorReviewSLAStatus
                    </MudChip>
                </MudTd>
                break;
            case "Payable":
                <MudTd DataLabel="SLA Status">
                    <MudChip T="string"
                             Size="Size.Small"
                             Variant="Variant.Filled"
                             Color="@GetSLAChipColor(context.ApproverReviewSLAStatus ?? "NA")">
                        @context.ApproverReviewSLAStatus
                    </MudChip>
                </MudTd>
                break;
            default:
                <MudTd DataLabel="SLA Status">
                    <MudChip T="string"
                             Size="Size.Small"
                             Variant="Variant.Filled"
                             Color="Color.Default">
                        NA
                    </MudChip>
                </MudTd>
                break;
        }
    </RowTemplate>
</MudTable>

@code {
    private string TrimInvoiceStatus(string? status)
    {
        if (string.IsNullOrWhiteSpace(status))
            return status ?? string.Empty;

        const string prefix = "With ";
        return status.StartsWith(prefix, StringComparison.OrdinalIgnoreCase)
            ? status[prefix.Length..]
            : status;
    }
}
<style>
/* Hover info styling for the Invoice Number cell */
.hover-wrapper {
  position: relative;
  display: inline-block;
}

.hover-info {
  display: none;
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  min-width: 200px;
  max-width: 320px;
  background: #fff;
  color: #222;
  padding: 8px;
  border-radius: 6px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  font-size: 12px;
  z-index: 1200;
  white-space: nowrap;
}

.hover-row {
  margin: 2px 0;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Show the info box when the wrapper (or any child) is hovered */
.hover-wrapper:hover .hover-info,
.hover-wrapper:focus-within .hover-info {
  display: block;
}

/* Slightly reduce size for small screens */

}
</style>