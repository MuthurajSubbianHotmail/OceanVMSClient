<AuthorizeView Context="auth">
    <Authorized>
        <div style="display:inline-flex; align-items:center; gap:.5rem;">
            <div class="auth-trigger" @onclick="TogglePanel" title="Open account panel">
                <MudAvatar Size="Size.Medium" Color="Color.Primary" Class="auth-panel-avatar" Icon="@Icons.Material.Filled.AccountCircle" />
                <div class="name">
                    @(!string.IsNullOrWhiteSpace(fullNameValue) ? FormatFullName(fullNameValue) : FormatFullName(auth.User.Identity?.Name))
                </div>
                <MudIconButton Icon="@Icons.Material.Filled.ArrowDropDown" Size="Size.Small" Color="Color.Inherit" DisableRipple="true" />
            </div>

        </div>

        @if (isPanelOpen)
        {
            <div class="auth-details-panel" role="dialog" aria-label="Account details">
                <div class="auth-panel-header">
                    <button class="close-btn" @onclick="ClosePanel" aria-label="Close">&times;</button>

                    <MudAvatar Size="Size.Large" Color="Color.Primary" Icon="@Icons.Material.Filled.Person" />
                    <div class="auth-panel-meta">
                        <div class="title">@(!string.IsNullOrWhiteSpace(fullNameValue) ? FormatFullName(fullNameValue) : FormatFullName(auth.User.Identity?.Name))</div>
                        @if (!string.IsNullOrWhiteSpace(userTypeValue))
                        {
                            <div class="subtitle">
                                @FormatUserType(userTypeValue)
                                @if (userTypeValue?.Equals("Vendor", StringComparison.OrdinalIgnoreCase) == true && !string.IsNullOrWhiteSpace(vendorNameValue))
                                {
                                    <span class="vendor-name" style="margin-left:.5rem; opacity:.95;">— @vendorNameValue</span>
                                }
                            </div>
                        }
                        @if (!string.IsNullOrWhiteSpace(rolesValue))
                        {
                            <div class="subtitle" style="margin-top:.25rem;">@FormatStringType(rolesValue)</div>
                        }
                    </div>
                </div>

                <div class="auth-panel-body">
                    @if (!string.IsNullOrWhiteSpace(emailValue))
                    {
                        <div style="margin-bottom:.5rem;"><strong>Email</strong> <div style="opacity:.9;">@emailValue</div></div>
                    }

                    <div style="margin-top:.25rem;">
                        <div style="display:flex; gap:.5rem; align-items:center;">
                            <MudChip T="string" Color="Color.Info" Variant="Variant.Outlined" Size="Size.Small">@FormatLabel("Account")</MudChip>
                            <MudText Typo="Typo.caption" Class="ml-auto" Color="Color.Secondary">@DateTime.Now.ToString("dd-MMM-yyyy")</MudText>
                        </div>
                    </div>

                    <div class="auth-panel-actions">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="NavigateToLogout" FullWidth="true" Size="Size.Small">
                            Log Out
                        </MudButton>
                        <MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="NavigateToChangePassword" FullWidth="true" Size="Size.Small">
                            Change Password
                        </MudButton>
                    </div>
                </div>
            </div>
        }
    </Authorized>

    <NotAuthorized>
        <div style="display:inline-flex; gap:.5rem; align-items:center;">
            <MudLink Href="Login" Color="Color.Inherit">LogIn</MudLink>
            <MudLink Href="vendor-registration/new" Color="Color.Inherit">Register</MudLink>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    
}

